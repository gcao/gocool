%h1= t('invitations.create_page_header')

= form_for @invitation, :url => api_invitation_path(@invitation), :remote => true, :html => {:class => "vertical", :id => 'edit_invitation_form'} do
  .row
    .span3
      %label(for="invitation_game_type")
        = t('invitations.game_type_label')
    .span9
      .field.game_type
        = radio_button :invitation, :game_type, '1'
        = t('games.weiqi_label')
        = radio_button :invitation, :game_type, '2'
        = t('games.daoqi_label')

  .row
    .span3
      %label(for="invitation_invitees")
        = t('invitations.invitees_label')
    .span9
      .field.invitee= @invitation.is_open ? t('invitations.open_invitation_note') : @invitation.invitee.nil_or.name

  .row
    .span3
      %label(for="invitation_start_side")
        = t('invitations.start_side_label')
    .span9
      =start_side_select

  .row
    .span3
      %label(for="invitation_handicap")
        = t('invitations.handicap_label')
    .span9
      =handicap_select

  .row
    .span3
      %label(for="invitation_rule")
        = t('invitations.rule_label')
    .span9
      .field.rule= t('invitations.chinese_rule')

  .row
    .span3
      %label(for="invitation_note")
        = t('invitations.note_label')
    .span9
      = text_field :invitation, :note

  .row
    .offset3.span9
      =hidden_field_tag "auth_token", @current_user.authentication_token
      =submit_tag t('form.submit_button'), :class => "btn btn-primary"
      =button_tag t('form.reset_button'), :name => "reset", :class => "btn"

- content_for :footer do
  :coffeescript
    $('#invitation_handicap').change ->
      handicap = $(this).val()
      if handicap == "0"
        if $('#invitation_start_side option[value=0]').length == 0
          $('#invitation_start_side').prepend("<option value='0'>#{t('invitations.random_start')}</option>")
      else
        start_side = $('#invitation_start_side').val()
        if start_side == '0'
          alert("#{t('invitations.reselect_start_side')}")
          $('#invitation_start_side option[value=0]').remove()

    $('#edit_invitation_form').bind 'ajax:success', (event, response) ->
      handleResponse response,
        before: -> console.log "#edit_invitation_form is submitted"

        callback: (response) ->
          switch response.status
            when 'success'
              window.location = gon.urls.api.invitations

            when 'validation_error'
              for error in response.errors
                alert("Server returned error: " + error.message)
                #showError(error.field, error.message)

